# 「思考回数の上限に達しました」現象の調査方針

現象
- UI上で「思考回数の上限に達しました。『続ける』を入力してください。」に類する警告が表示される。

仮説（原理）
- モデルの内部思考（reflection/chain-of-thought）や長い逐次推論で、実装側のステップガード/トークンガードに到達。
- セッション内の連続要求で、ステップ上限・トークン上限・時間上限のいずれかにヒット。
- 特定モデル（例: GPT-5 / Claude-4）でポリシーが異なり、UIでガードが明示される。

計測設計
- think_cycles：進捗ログから内部思考の近似カウントを取得（src/orchestratorのSSE進捗にチェックポイント）。
- t_total / t_first_token：時間上限の影響を測定。
- 出力上限（8k/10k/15k）とk（集約係数）を振って、上限到達タイミングの分布を作成。

対策案
- タスク分割（長い推論を章/フェーズに分ける）。
- 反省/自己修正の回数制限（プロンプトで明示）。
- 文脈ローリング要約で入力を短縮、出力は章分割＋上限管理。
- モデル切替：同条件でGPT-5/Claude-4を比較し、上限に強い方を採用または併用。

保存先
- 計測ログ：ORCH/LOGS/2025-10/trae_credit_bench/
- 検証データ：data/validation/benchmarks/trae_credit_bench_20251009/