概要

本ドキュメントは、ORCH-Next の成果物品質を定量評価し、段階的合格判定と恒久化（AUTO_DECIDE 連携）に用いる基準を定義します。評価は共通評価・特質評価・斬新さ/画期性の3カテゴリの重み付き合算で算出し、70/85/95点の段階的合格を採用します。

1) 共通評価（機能性・信頼性・ユーザー中心性）
2) 特質評価（分野特有の特性）
3) 斬新さ/画期性（新規性・技術的独自性）

評価カテゴリと重み
- 共通評価: 40%
- 特質評価: 40%
- 斬新さ/画期性: 20%

段階的合格判定（ゲート）
- 70点: 機能が安定して基本要件を満たす（Staging 合格）。
- 85点: 運用で十分に安定・回復性を備える（Pre-Prod 合格）。
- 95点: 本番自動承認（AUTO_DECIDE の対象）。

推奨しきい値（上限・目安）
HTTP API
- 成功率: 95%以上（強制）
- 平均レイテンシ: 500ms未満（推奨）
- P95レイテンシ: 1500ms未満（強制）
- 最大レイテンシ: 3000ms未満（推奨）

SSE（イベント配信）
- 接続復旧（断後の再接続）: 2秒以内（推奨）、5秒以内（強制）
- メッセージ遅延 P95: 1000ms未満（推奨）
- ドロップ率: 1%未満（推奨）、5%未満（強制）

資源使用（運用安定性）
- CPU 使用率（平均）: 75%未満（推奨）
- メモリ使用率（平均）: 75%未満（推奨）
- スレッド/タスク飽和: 許容閾値以内（デッドロック0）

並行上限（ロードテストの設計目安）
- 通常: 同時 50（HTTP）、SSE 接続 100
- 負荷: 同時 100（HTTP）、SSE 接続 200
- イレギュラー（ネットワーク揺らぎ・再試行・一部 5xx）: 通常/負荷に対してエラー耐性を検証
- 極限: 上限 200〜300（HTTP）、SSE 接続 400〜500（短時間）

スコア算出方法（例）
1. 共通評価（50点満点）
   - 成功率（20点）: 95%を基準に線形、100%で満点。
   - レイテンシ（20点）: 平均/ P95 の達成率で加点。
   - ユーザー中心性（10点）: UX指標（タイムトゥファーストレスポンス、安定度）。

2. 特質評価（30点満点）
   - ドメイン固有の正確性・整合性（例: メトリクスの一貫性、予測の妥当性）
   - 運用適合（監視・アラート・ロールバックの有効性）

3. 斬新さ/画期性（20点満点）
   - 技術的新規性（工夫、アルゴリズム、設計の独創性）
   - 実用的価値（単なる新規性ではなく、実際の効果）

自動判定（ゲート連携）
- 70点到達: Staging 合格（継続検証）。
- 85点到達: Pre-Prod 合格（Canary 継続）
- 95点到達: AUTO_DECIDE による自動承認対象（ルール 7 に準拠）。

検証方法（推奨）
1. 段階的負荷テストを pytest で実施（tests/load/*）。
2. 結果を data/test_results/ に JSON で保存。
3. スコアリングスクリプト（scripts/ops/validate_quality_doc.py と将来の aggregator）で品質スコアを算出。
4. CI でしきい値違反があれば fail。

付記
- しきい値は環境ごとに微調整可能だが、強制項目（成功率95%、P95 1500ms未満、SSE再接続≤5s、ドロップ率≤5%）は不変。
- 詳細は CI 連携のルール（.trae/rules/project_rules.md の「品質評価基準・参照自動化・恒久化」）を参照。
 - 強制しきい値（キーフレーズ）: 成功率95% / P95 1500ms / 再接続≤5s / ドロップ率≤5%
本ドキュメントは、成果物クオリティー評価のしきい値とスコアリング方法、段階的合格判定（70/85/95点）を定義します。Web/デザイン、ソフトウェア/アプリ、セキュリティなど多様な成果物に適用できる汎用版です。

評価カテゴリと重み（合計100点）
- 共通評価（40点）：機能性・信頼性/安定性・ユーザー中心性の基盤品質
- 特質評価（40点）：分野固有の特性（性能/統合性、視覚/応答性、脅威耐性）
- 斬新さ/画期性（20点）：差別化・スケーラビリティ/影響力

スコアリング方法（各カテゴリ0–5点→重み換算）
各カテゴリ内の複数指標を同等重みで平均し、0–5点スケールに正規化。カテゴリスコア（0–5）を重みで換算し、総合スコア（0–100）を算出します。

1. 共通評価（0–5点、重み40）
- 機能性（テスト合格率・エラー率）
  - 5点：合格率≥99%、エラー率<1%
  - 4点：合格率≥98%、エラー率<2%
  - 3点：合格率≥95%、エラー率<5%
  - 2点：合格率≥90%、エラー率<10%
  - 1点：上記未満
- 信頼性/安定性（Canary成功率・SSE成功率）
  - 5点：Canary成功率≥97%、SSE成功率≥97%
  - 4点：≥95% / ≥95%
  - 3点：≥90% / ≥90%
  - 2点：≥80% / ≥80%
  - 1点：上記未満
- ユーザー中心性（応答性・可用性）
  - 5点：ダッシュボード初回応答<2s、SSE初回メッセージ平均<1s、SSE p95<2s
  - 4点：<2.5s / <1.2s / <2.5s
  - 3点：<3s / <1.5s / <3s
  - 2点：<4s / <2s / <4s
  - 1点：上記未満

2. 特質評価（0–5点、重み40）
- 性能/統合性（APIレイテンシ・資源使用・外部連携）
  - 5点：HTTP成功率≥95%、平均<500ms、p95<1500ms、CPU<50%、メモリ増分<100MB、外部連携エラーほぼ無し
  - 4点：成功率≥93%、平均<700ms、p95<2000ms、CPU<60%、メモリ<150MB
  - 3点：成功率≥90%、平均<1000ms、p95<3000ms、CPU<70%、メモリ<200MB
  - 2点：成功率≥85%、平均<1500ms、p95<5000ms
  - 1点：上記未満
- 視覚/応答性（Web/デザイン）
  - 5点：主要ビューのロード<2s、SSE更新途切れなし、視覚的一貫性良好
  - 4点：ロード<2.5s、軽微な途切れ
  - 3点：ロード<3s、途切れ発生だが回復
  - 2点：ロード<4s、途切れ頻発
  - 1点：上記未満
- 脅威耐性（セキュリティ）
  - 5点：既存セキュリティテスト全合格、重大脆弱性0、JWT/HMAC契約テスト合格
  - 4点：軽微指摘のみ
  - 3点：中程度指摘あり（回避策あり）
  - 2点：重大指摘あり（暫定策）
  - 1点：未検証/高リスク

3. 斬新さ/画期性（0–5点、重み20）
- 差別化度（自動化・独自機能・運用効率化）
  - 5点：AUTO_DECIDE/Canary自動化の高成熟、独自機能が運用効果を立証
  - 4点：自動化カバレッジ≥80%
  - 3点：≥60%
  - 2点：≥40%
  - 1点：<40%
- スケーラビリティ/影響力
  - 5点：負荷耐性優秀（SSE100–200安定、HTTP100安定）、運用価値高い
  - 4点：安定的スケール（SSE100/HTTP50）
  - 3点：限定的スケール
  - 2点：スケールに課題
  - 1点：未評価

段階的合格判定（ゲート）
- 第一次クリア：総合スコア ≥ 70点（基本品質を満たす）
- 第二次テスト：総合スコア ≥ 85点（強化負荷・イレギュラーにも耐性）
- 最終テスト：総合スコア ≥ 95点（極限テスト含め高水準の品質）

しきい値（推奨）と上限
- HTTP API：成功率≥95%、平均<500ms、p95<1500ms（通常）。ストレス時成功率≥85%、p95<5000ms
- SSE：成功率≥95%、初回平均<1s、p95<2s、接続時間p95<3s（通常）。ストレス時成功率≥80%、初回p95<5s、接続p95<10s
- 資源使用：CPU<50%、メモリ増分<100MB（通常運用時）。
- 并行上限（運用目安）：HTTP 100、SSE 150（安定～負荷間）。極限テストはSSE 300–500、HTTP 200まで段階的に実施。

スコア算出の例（自動化用ロジック）
1) Canary/負荷テスト結果（data/test_results/*）から成功率・レイテンシを集計
2) 既存セキュリティ/契約テストの結果を取り込み
3) 指標ごとに上記ルーブリックで0–5点にマッピング
4) カテゴリ平均→重み換算→総合スコア（0–100）
5) ゲート判定（70/85/95）と恒久化処置（AUTO_DECIDE維持、ルール更新、安定化マーカー出力）

備考
- 実測に基づきしきい値は微調整（監視間隔スイープ：3/5/10/15秒）を実施。最適値はCPU負荷、SSE成功率、レイテンシの総合バランスで決定。
- 指標はプロジェクト規模・リソースに応じて調整可能。変更は config/monitoring.json と tests/load/* の閾値へ反映。