# 753.193 Party Reflex 実装ロードマップ

本ドキュメントは Phase A/B/C をスプリント単位に分解し、各ステップの目的・タスク・成果物・受け入れ条件を定義する。

## 0. 前提
- Kivy 2.3 / Python 3.13 環境は構築済み（PC 表示での基本動作確認済）。
- 出題データ・サウンド・画像などのアセットはこれから作成。
- 既存レガシーテストの失敗は Phase C で別途扱う。

## 1. スプリント計画（Phase A: コア体験）

| Sprint | 期間目安 | 目的 | 主担当タスク | 成果物 / 受け入れ条件 |
|--------|----------|------|--------------|------------------------|
| **A1** | 1週 | 出題エンジン拡張 | - G1 テキスト 20問<br>- G2 画像カテゴリ仮素材(10枚)<br>- `QuizEngine` に画像読込＆効果チェーン実装<br>- `CuePanel` で画像/テキスト切替 | - Arena 画面でカテゴリ選択→問題が循環する<br>- flip/mosaic/shake が仕様値で反映される<br>- 画像素材は `assets/images` に配置し JSON で参照 |
| **A2** | 1週 | プレイ演出強化 | - 握りアイコン点滅・指サークルアニメ<br>- CuePanel 白→黄120ms / shake 挙動<br>- reveal/fault/win サウンド再生<br>- フライング時の赤点滅・ハプティクスHook | - START→合図→結果で演出が揃う<br>- 音声3種が `assets/se` から再生される<br>- 仕様書のタイミング値に沿ったトランジション |
| **A3** | 1週 | 結果画面仕上げ | - ランキングテーブル整備（色アイコン/連勝ピル）<br>- 同着/フライング文言表示<br>- シードハッシュ/再戦導線/別メンバー導線<br>- RoundResult ログに追記 | - 結果画面が仕様どおり表示される<br>- 連続プレイ時にログが蓄積される<br>- 再戦/別メンバー選択で画面遷移が正しく動作 |

## 2. スプリント計画（Phase B: プレイ前導線）

| Sprint | 期間目安 | 目的 | 主担当タスク | 成果物 / 受け入れ条件 |
|--------|----------|------|--------------|------------------------|
| **B1** | 1週 | ホーム/ゲーム選択 | - ホーム画面実装（人数/ゲーム選択/設定）<br>- `ScreenManager` 遷移整理<br>- モード設定（G1/G2/G3） | - 起動→ホーム→カテゴリ/メンバーの導線が成立 |
| **B2** | 1週 | メンバー設定 | - 名前入力/COM/Lv/配置ドラッグ<br>- 禁止語フィルタ・UTF-8 20文字制限<br>- メンバー情報を `AppSettings` で永続化 | - メンバー決定状況がプレイ画面に反映される |
| **B3** | 1週 | カテゴリUX仕上げ | - お気に入りトグル/全選択・全解除ボタン<br>- 選択件数/問題数の即時表示<br>- スクロールUI最適化 | - カテゴリ選択画面で仕様どおり操作できる |

## 3. スプリント計画（Phase C: 補強・検証）

| Sprint | 期間目安 | 目的 | 主担当タスク | 成果物 / 受け入れ条件 |
|--------|----------|------|--------------|------------------------|
| **C1** | 1週 | モバイル適応 | - 画面サイズ検出・ヒットテスト調整<br>- 縦横回転の抑止/対応ポリシー決定<br>- DPI/レスポンシブ調整 | - 実機/エミュでヒット率95%、フライング検出正常 |
| **C2** | 1週 | テスト整備 | - Kivy UI の自動テスト（pytest + kivy Clock）<br>- 既存 Legacy テストの優先修正（MobileAdapter など） | - `pytest -q` がすべて PASS（スキップ除く） |
| **C3** | 1週 | リソース管理・仕上げ | - 画像/SE の正式素材差し替え<br>- ログ削除UI、設定のリセット<br>- ストア提出用スクリーンショット更新 | - リリース候補ビルドが QA を通過 |

## 4. アセット準備タイムライン
- **音源**: A2 着手前に 3 種（reveal/fault/win）の短尺SE を準備。
- **画像**: A1 で仮素材、B3 までに正式版（カテゴリアイコン/背景/チュートリアル）。
- **フォント**: 現状自動検出で対応。必要に応じて Noto Sans CJK を同梱。

## 5. リスクと対応
| リスク | 想定影響 | 対策 |
|--------|----------|------|
| Py/Kivy 依存更新 | ビルド失敗 | `requirements.txt` ピン止め、CI でバージョンチェック |
| アセット未確保 | UI が仮素材のまま | 企画側と共有して期限を設定 (A1開始前)
| Legacy テスト | `pytest` 失敗でパイプライン停止 | C2 で段階的に対応、優先度を決めてリファクタ |
| マルチタッチ差異 | 実機で挙動不一致 | C1 で機種ごとにヒットテスト調整 + ログ分析 |

## 6. チェックポイント
- **A3 完了**: コアゲームループが仕様通り動く状態。
- **B3 完了**: ホーム→プレイ→結果までのUXが一通り揃う。
- **C3 完了**: リリース候補ビルドを QA/ストア審査に回せる状態。

毎スプリントの成果は `docs/plan_comparison.md` と合わせて更新し、`data/logs/current` に自動保存されるデータで QA を行う。
