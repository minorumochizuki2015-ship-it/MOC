# 作業ルール（Working Rules）

目的: 本プロジェクトの品質・安全性・再現性・可観測性を高水準で維持するための共通ルールを定義する。

## ブランチ戦略
- main: 安定版のみ（CIの全ゲート通過、リリースタグ付与）
- develop: 次リリース候補（日次の統合）
- feature/*: 機能ごとの作業ブランチ（短命・小粒）
- hotfix/*: 緊急修正（mainへ直行→developへ反映）

## コミット/PR
- Conventional Commits（feat, fix, docs, chore, refactor など）
- コミットは小さく、テストとセットで作ること
- PRには: 目的/変更点/テスト範囲/影響範囲/ロールバック手順を記載
- レビュー: 原則2名、変更が小規模なら1名可

## テスト・品質ゲート
- 単体・統合テスト必須（pytest）
- カバレッジ閾値: 80% 以上（例外はエビデンス付きで承認）
- 静的解析: flake8, isort, black --check, mypy（strict推奨）
- セキュリティ: secrets スキャン、依存性監査（pip-audit/safety）
- 脆弱性対策: 重大CVSSスコアはリリース阻止対象

## セキュリティ/コンプライアンス
- 機密情報（キー/トークン/個人情報）はリポジトリに置かない
- SBOM（CycloneDX）生成とライセンス検証をリリース前に実施
- 成果物の署名（cosign など）と Provenance 生成を順次導入

## リリース/運用
- SemVer 準拠（MAJOR.MINOR.PATCH）
- Canary リリース→監視→段階的ロールアウト
- ロールバック手順を常時維持（scripts/ops/rollback_release.ps1）
- 可観測性（ログ/メトリクス/トレース）を標準化

## ドキュメント更新
- 変更時は関連ドキュメント（仕様/設計/テスト/運用）を同一PRで更新
- MILESTONES と CHECKLIST を維持し、CI品質ゲートと整合させる

## 例外運用
- 例外は原則一時的（期限・責任者・代替案・フォロータスクを明記）