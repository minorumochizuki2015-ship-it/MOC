#:kivy 2.3.0
#:import dp kivy.metrics.dp

# プレイ画面の主要レイアウト定義。
<PlayerCircle>:
    size_hint: None, None
    size: dp(96), dp(96)
    canvas.before:
        Color:
            rgba: root.background_rgba
        Ellipse:
            pos: self.pos
            size: self.size
        Color:
            rgba: (1, 1, 1, 1)
        Line:
            width: dp(4)
            ellipse: (self.x, self.y, self.width, self.height)
    Label:
        text: root.label_text
        font_name: app.default_font or 'Roboto'
        color: 0, 0, 0, 1
        font_size: "20sp"
        bold: True
        size_hint: None, None
        size: self.texture_size
        pos: root.center_x - self.width / 2, root.center_y - self.height / 2
    Label:
        text: "握る"
        font_name: app.default_font or "Roboto"
        color: 1, 1, 1, root.waiting_alpha
        font_size: "16sp"
        size_hint: None, None
        size: self.texture_size
        pos: root.center_x - self.width / 2, root.center_y - self.height / 2

<CuePanel>:
    orientation: "vertical"
    padding: dp(12)
    spacing: dp(8)
    size_hint: (0.72, 0.45)
    canvas.before:
        Color:
            rgba: root.background_rgba
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12)]
        Color:
            rgba: (0.13, 0.13, 0.13, 1)
        Line:
            width: dp(1.4)
            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(12))
    Label:
        id: noise_label
        text: root.noise_text
        font_name: app.default_font or "Roboto"
        color: (0.3, 0.3, 0.3, 0.8)
        font_size: "20sp"
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]
    Image:
        id: target_image
        source: root.image_source
        opacity: 1 if root.image_visible else 0
        size_hint_y: None
        height: dp(220) if root.image_visible else 0
        allow_stretch: True
        keep_ratio: True
    Label:
        id: target_label
        text: root.target_text
        font_name: app.default_font or "Roboto"
        color: (0, 0, 0, 1)
        font_size: "26sp"
        bold: True
        text_size: self.width, None
        size_hint_y: None
        opacity: 0 if root.image_visible else 1
        height: self.texture_size[1] if not root.image_visible else 0
    Label:
        id: prompt_label
        text: root.prompt_text
        font_name: app.default_font or "Roboto"
        color: (0.9, 0.6, 0, 1)
        font_size: "18sp"
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]

<StatusBanner>:
    size_hint_y: None
    height: dp(32)
    padding: dp(8), 0
    canvas.before:
        Color:
            rgba: (0.93, 0.93, 0.93, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(6)]
    Label:
        text: root.message
        font_name: app.default_font or 'Roboto'
        color: (0, 0, 0, 1)
        font_size: "18sp"
        bold: True
        halign: "left"
        valign: "middle"
        text_size: self.size

<ArenaScreen>:
    name: "arena"
    BoxLayout:
        orientation: "vertical"
        padding: dp(12)
        spacing: dp(8)
        StatusBanner:
            id: status_banner
            message: app.strings.get("status_ready", "")
        FloatLayout:
            id: arena_root
            PlayerCircle:
                id: player_p1
                controller: root
                player_id: "P1"
                label_text: "P1"
                color_hex: "#FF3B30"
                pos_hint: {"x": 0.05, "y": 0.72}
            PlayerCircle:
                id: player_p2
                controller: root
                player_id: "P2"
                label_text: "P2"
                color_hex: "#007AFF"
                pos_hint: {"x": 0.05, "y": 0.08}
            PlayerCircle:
                id: player_p3
                controller: root
                player_id: "P3"
                label_text: "P3"
                color_hex: "#34C759"
                pos_hint: {"x": 0.78, "y": 0.08}
            PlayerCircle:
                id: player_p4
                controller: root
                player_id: "P4"
                label_text: "P4"
                color_hex: "#FFCC00"
                pos_hint: {"x": 0.78, "y": 0.72}
            CuePanel:
                id: cue_panel
                pos_hint: {"center_x": 0.5, "center_y": 0.5}
                noise_text: app.strings.get("place_wait_release", "")
                target_text: ""
                prompt_text: app.strings.get("hold_to_start", "")
        BoxLayout:
            size_hint_y: None
            height: dp(64)
            spacing: dp(12)
            Button:
                text: app.strings.get("start_button", "START")
                font_name: app.default_font or "Roboto"
                on_release: root.dispatch_start()
            Button:
                text: app.strings.get("reset_button", "リセット")
                font_name: app.default_font or "Roboto"
                on_release: root.dispatch_reset()
